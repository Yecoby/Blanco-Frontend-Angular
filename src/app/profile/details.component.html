<h1 class="text-center mb-4">My Profile</h1>

<!-- Account Details Section -->
<div class="card p-4 mb-4">
    <h2 class="mb-4">Account Details</h2>
    <div *ngIf="account">
        <div class="mb-3">
            <strong>Name: </strong> {{ account.firstName }} {{ account.lastName }}<br />
            <strong>Email: </strong> {{ account.email }}<br />
            <strong>Phone Number: </strong> {{ account.phoneNumber }}<br />
            <strong>Role: </strong> {{ account.role }}<br />
        </div>
        <!-- Update Profile Button -->
        <div class="text-start">
            <a routerLink="update" class="btn btn-success">Update Profile</a>
        </div>
    </div>
</div>

<!-- Branch Information Card for Manager -->
<div *ngIf="isManager()" class="card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Branch Information</h3>
        <button (click)="toggleBranchInfo()" class="btn btn-info">
            {{ showBranchInfo ? 'Hide Branch Information' : 'Show Branch Information' }}
        </button>
    </div>
    <!-- Branch Info Display -->
    <div *ngIf="showBranchInfo" class="mt-3">
        <div class="card p-3 bg-light">
            <strong>Branch: </strong> {{ branch?.name || 'No Branch Assigned' }}<br />
            <strong>Location: </strong> {{ branch?.location || 'N/A' }}<br />
            <strong>Status: </strong> {{ branch?.branchStatus || 'N/A' }}
        </div>
    </div>
</div>

<!-- Activity Logs Section -->
<div class="card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Activity Logs</h3>
        <button (click)="toggleActivityLogs()" class="btn btn-info">
            {{ showActivityLogs ? 'Hide Activity Logs' : 'Show Activity Logs' }}
        </button>
    </div>
    <!-- Activity Logs Filter -->
    <div *ngIf="showActivityLogs">
        <!-- Filters for Action Type, Start & End Date -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <label for="actionType">Action Type Search:</label>
                <input
                    type="text"
                    id="actionType"
                    class="form-control"
                    placeholder="Search by action type..."
                    [(ngModel)]="searchTerm"
                    (input)="handleSearch()"
                />
            </div>
            <div class="col-md-4">
                <label for="startDate">Start Date:</label>
                <input
                    type="datetime-local"
                    id="startDate"
                    class="form-control"
                    [(ngModel)]="startDate"
                    (change)="handleSearch()"
                />
            </div>
            <div class="col-md-4">
                <label for="endDate">End Date:</label>
                <input
                    type="datetime-local"
                    id="endDate"
                    class="form-control"
                    [(ngModel)]="endDate"
                    (change)="handleSearch()"
                />
            </div>
        </div>

        <!-- Logs Table -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Action Type</th>
                        <th>Details</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let log of filteredLogs">
                        <td>{{ log.actionType }}</td>
                        <td>{{ log.actionDetails }}</td>
                        <td>{{ log.timestamp | date:'MM/dd/yy, hh:mm a' }}</td>
                    </tr>
                    <tr *ngIf="filteredLogs.length === 0">
                        <td colspan="3" class="text-center">No activity logs found</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Admin Section for Viewing All Activity Logs -->
<div *ngIf="isAdmin()" class="card p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>All Activity Logs (Admin Only)</h3>
        <button (click)="toggleAllActivityLogs()" class="btn btn-info">
            {{ showAllActivityLogs ? 'Hide All Logs' : 'Show All Logs' }}
        </button>
    </div>
    <div *ngIf="showAllActivityLogs">
        <!-- Filters for Action Type, Start & End Date for Admin -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <label for="actionType">Action type:</label>
                <input
                    [(ngModel)]="adminSearchTerm"
                    (change)="handleAdminSearch()"
                    placeholder="Search all log actions"
                    class="form-control"
                />
            </div>
            <div class="col-md-4">
                <label for="startDate">Start Date:</label>
                <input
                    [(ngModel)]="adminStartDate"
                    (change)="handleAdminSearch()"
                    type="datetime-local"
                    class="form-control"
                />
            </div>
            <div class="col-md-4">
                <label for="endDate">End Date:</label>
                <input
                    [(ngModel)]="adminEndDate"
                    (change)="handleAdminSearch()"
                    type="datetime-local"
                    class="form-control"
                />
            </div>
        </div>

        <!-- All Logs Table -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Action Type</th>
                        <th>User</th>
                        <th>Details</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let log of filteredAllLogs">
                        <td>{{ log.actionType }}</td>
                        <td>{{ log.userEmail }} ({{ log.userRole }})</td>
                        <td>{{ log.actionDetails }}</td>
                        <td>{{ log.timestamp | date:'MM/dd/yy, hh:mm a' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
